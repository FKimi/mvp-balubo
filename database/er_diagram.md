# balubo データベース ER図概念

## 概要

baluboのデータベース設計は、ユーザー、プロフィール、作品、タグ、AI分析結果、ポートフォリオ設定の主要エンティティを中心に構成されています。以下にER図の概念と各エンティティの関連性を説明します。

## エンティティと関連性

```
+---------------+       +---------------+       +---------------+
|     users     |       |    profiles   |       |     works     |
+---------------+       +---------------+       +---------------+
| id            |<----->| id            |       | id            |
| name          |       | user_id       |       | user_id       |
| email         |       | profession    |       | title         |
| password      |       | biography     |       | description   |
| ...           |       | ...           |       | source_url    |
+---------------+       +---------------+       | ...           |
      ^                                         +---------------+
      |                                                ^
      |                                                |
      |                                                |
      |                 +---------------+              |
      |                 |      tags     |              |
      |                 +---------------+              |
      |                 | id            |              |
      |                 | name          |<-------------+
      |                 | type          |              |
      |                 | ...           |              |
      |                 +---------------+              |
      |                        ^                       |
      |                        |                       |
      |                        |                       |
+---------------+     +---------------+     +---------------+
| portfolio_    |     |   user_tags   |     |   work_tags   |
| settings      |     +---------------+     +---------------+
+---------------+     | id            |     | id            |
| id            |     | user_id       |     | work_id       |
| user_id       |     | tag_id        |     | tag_id        |
| theme         |     | proficiency   |     | relevance_    |
| ...           |     | ...           |     | score         |
+---------------+     +---------------+     +---------------+
      ^
      |
      |
      |
+---------------+
|  ai_analyses  |
+---------------+
| id            |
| user_id       |
| specialty_    |
| score         |
| skill_score   |
| ...           |
+---------------+
```

## エンティティの説明

### 1. users

既存のLaravelユーザーテーブルで、認証情報と基本的な個人情報を保持します。

**主キー**: id
**関連**: 
- profiles (1:1)
- works (1:多)
- user_tags (1:多)
- portfolio_settings (1:1)
- ai_analyses (1:1)

### 2. profiles

ユーザーの詳細なプロフィール情報を保持します。

**主キー**: id
**外部キー**: user_id (users.id への参照)
**関連**: 
- users (多:1)

### 3. works

ユーザーが登録した作品情報を保持します。

**主キー**: id
**外部キー**: user_id (users.id への参照)
**関連**: 
- users (多:1)
- tags (多:多、work_tags を介して)

### 4. tags

作品やユーザーに関連付けられるタグを保持します。

**主キー**: id
**関連**: 
- works (多:多、work_tags を介して)
- users (多:多、user_tags を介して)

### 5. work_tags

作品とタグの多対多関連を管理する中間テーブル。

**主キー**: id
**外部キー**: 
- work_id (works.id への参照)
- tag_id (tags.id への参照)
**関連**: 
- works (多:1)
- tags (多:1)

### 6. user_tags

ユーザーとタグの多対多関連を管理する中間テーブル。ユーザーのスキルや専門分野を表現します。

**主キー**: id
**外部キー**: 
- user_id (users.id への参照)
- tag_id (tags.id への参照)
**関連**: 
- users (多:1)
- tags (多:1)

### 7. ai_analyses

AIによるユーザーの分析結果を保持します。

**主キー**: id
**外部キー**: user_id (users.id への参照)
**関連**: 
- users (多:1)

### 8. portfolio_settings

ユーザーのポートフォリオ表示設定を保持します。

**主キー**: id
**外部キー**: user_id (users.id への参照)
**関連**: 
- users (多:1)

## インデックス戦略

パフォーマンス最適化のため、以下のインデックスを設定しています：

1. 外部キーにはすべてインデックスを設定
2. 頻繁に検索される列（user_id, is_public など）にインデックスを設定
3. 複合インデックス（user_id + is_public など）を適切に設定
4. ユニーク制約が必要な列（custom_slug, custom_domain など）にユニークインデックスを設定

## 拡張性への配慮

1. JSON型のカラムを活用することで、スキーマ変更を最小限に抑えつつ追加データを格納できるように設計
2. ステータスなどの列を適切にenum型で定義し、将来的な状態追加に備える
3. 中間テーブルを適切に設計し、複雑な多対多関連をサポート

## 性能最適化

1. 不必要な JOIN を避けるために、頻繁にアクセスされる情報は非正規化することも検討
2. 長いテキスト列やJSONデータは必要に応じて圧縮を検討
3. 大量のデータが予想される場合はパーティショニングを検討 